buildscript {
  repositories {
    mavenLocal()
    mavenCentral()
  }
}
plugins {
  id "java"
  id "com.palantir.graal" version "0.12.0"
}

repositories {
  mavenLocal()
  mavenCentral()
//  maven { url "https://oss.sonatype.org/content/repositories/snapshots/" }
}

sourceCompatibility = JavaVersion.VERSION_17
targetCompatibility = JavaVersion.VERSION_17

def className = "com.mageddo.dnsproxyserver.App"

graal {
  mainClass className
  graalVersion(graalVMVersion)
  outputName(project.name)
  javaVersion("17")
//  option("-H:+ReportUnsupportedElementsAtRuntime")
  option("--no-server")
  option("-J-Xmx5G")
}

dependencies {
  compileOnly group: 'org.projectlombok', name: 'lombok', version: '1.18.24'
  annotationProcessor group: 'org.projectlombok', name: 'lombok', version: '1.18.24'

  compileOnly(group: "com.mageddo.nativeimage", name: "reflection-config-generator", version: "2.3.4")
  annotationProcessor(group: "com.mageddo.nativeimage", name: "reflection-config-generator", version: "2.3.4")

  implementation group: 'org.apache.commons', name: 'commons-lang3', version: '3.8.1'
  implementation group: 'com.mageddo.tinyserver', name: 'tinyserver', version: '1.0.0'
  implementation group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.14.1'
  implementation group: "ch.qos.logback", name: "logback-classic", version: "1.2.3"

  testCompileOnly group: 'org.projectlombok', name: 'lombok', version: '1.18.24'
  testAnnotationProcessor group: 'org.projectlombok', name: 'lombok', version: '1.18.24'
  testImplementation(group: "org.junit.jupiter", name: "junit-jupiter", version: "5.8.2")
  testImplementation(group: "org.mockito", name: "mockito-junit-jupiter", version: "4.2.0")
}

test {
  useJUnitPlatform()
  testLogging {
    events "passed", "skipped", "failed"
  }
}
